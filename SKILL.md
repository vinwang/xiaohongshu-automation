# 小红书自动化发布 Skill

完整的小红书内容生成、图片创建、预览确认和定时发布自动化流程。

**本地化版本** - 无需 n8n，完全本地运行！

## 核心功能

### 1. 智能内容生成
- **二极管标题法**: 使用正/负刺激创作吸引眼球的标题（<20字）
- **结构化正文**: 50-600字，包含开篇钩子、核心内容、互动引导
- **智能标签**: 自动从小红书热门关键词包中选择相关标签
- **风格匹配**: 根据主题自动匹配内容风格（生活/职场/情感/促销）

### 2. AI 图片生成
- **封面图**: 使用火山引擎 Doubao-Seedream 生成高质量封面
- **内容图**: 根据正文观点自动生成 2-3 张内容图片
- **科技风格**: 浅色风格，无水印、无Logo、无乱码
- **尺寸优化**: 1728x2304px，符合小红书推荐比例

### 3. 矩阵账号差异化
- **多账号支持**: 同时为多个小红书账号生成差异化内容
- **智能改写**: 保持结构不变的前提下进行差异化改写
- **批量发布**: 支持矩阵账号批量定时发布

### 4. 交互式预览
- **实时预览**: 在浏览器中预览生成的笔记效果
- **图片轮播**: 支持封面图和内容图的左右滑动浏览
- **定时选择**: 可选择立即发布或定时发布
- **确认机制**: 发布前需要用户确认，避免误操作

### 5. 自动发布
- **MCP 集成**: 通过 MCP 客户端调用小红书发布接口
- **数据持久化**: 自动保存笔记到 n8n 数据表
- **定时发布**: 支持指定时间自动发布
- **发布状态**: 实时反馈发布结果

## 快速开始（本地化版本）

### 安装

```bash
cd .codebuddy/skills/xiaohongshu-automation
npm install
```

### 配置

```bash
# 复制配置文件
cp .env.example .env

# 编辑 .env，填入 API Key 和 Cookie
```

或使用 CLI 配置：

```bash
npm run dev config
```

### 使用

```bash
# 交互式发布
npm run dev publish

# 命令行参数
npm run dev publish -t "AI写作工具"

# 快速发布（跳过预览）
npm run dev publish -t "AI写作工具" -q

# 只生成内容
npm run dev publish -t "AI写作工具" -g

# 查看历史
npm run dev history
```

### 完整工作流程

1. **输入** - 提供主题、账号、字数、背景
2. **生成内容** - AI 生成标题、正文、标签
3. **生成图片** - AI 生成封面和内容图
4. **预览确认** - 浏览器预览，确认发布
5. **发布** - 立即发布或定时发布

## 工作流程

### 阶段 1: 输入解析
```
用户输入 (自然语言/JSON/CLI参数)
    ↓
解析输入参数
    ↓
提取: 主题/选题、账号列表、字数、背景
```

**输入格式**:
- **自然语言**: "主题：AI写作工具，账号：张三、李四，字数：500，背景：介绍AI写作优势"
- **JSON**: `{"topic": "AI写作工具", "accounts": ["张三", "李四"], "word_count": 500, "context": "..."}`

### 阶段 2: 内容创作
```
选题结构生成 (LLM)
    ↓
标题创作 (二极管标题法)
    ↓
正文大纲生成
    ↓
正文生成 (LLM + 风格匹配)
    ↓
正文结构拆分 (标题/正文/图片建议/标签)
```

**LLM 提示词技巧**:
- 二极管标题法: 正面刺激/负面刺激
- 开篇钩子: 痛点问题/争议话题
- 热门关键词: 近30天搜索量top500
- 互动结尾: 开放问题/投票/晒图

### 阶段 3: 图片生成
```
配图 Prompt 生成 (LLM)
    ↓
封面图 Prompt
    ↓
内容图 Prompts (2-3个)
    ↓
火山引擎图片生成 API
    ↓
返回图片 URL
```

**图片生成要求**:
- 不出现乱码、假字、不可识别字符
- 无平台标识、角标、水印、Logo
- 科技质感，浅色风格
- 清晰具体、可视觉化的画面内容

### 阶段 4: 矩阵差异化 (可选)
```
如果是多账号
    ↓
矩阵账号拆分
    ↓
矩阵差异化改写 Agent (LLM)
    ↓
为每个账号生成差异化内容
```

### 阶段 5: 组装与预览
```
组装文案节点
    ↓
合并: 标题 + 正文 + 标签 + 封面图 + 内容图
    ↓
生成 HTML 预览
    ↓
发送预览到浏览器
```

**预览功能**:
- 图片轮播（左右滑动）
- 显示标题、正文、标签
- 确认/取消按钮
- 定时发布选择器

### 阶段 6: 用户确认
```
用户在浏览器中查看预览
    ↓
点击"确认发布"按钮
    ↓
触发 n8n Wait 节点 (webhook)
    ↓
继续发布流程
```

### 阶段 7: 定时发布
```
等待用户确认
    ↓
选择发布时间 (立即/定时)
    ↓
⏰定时发布 Wait 节点
    ↓
到达指定时间后继续
```

### 阶段 8: 数据持久化与发布
```
保存到 n8n 数据表 (Upsert)
    ↓
调用 MCP 发布接口
    ↓
小红书 API
    ↓
发布成功/失败反馈
```

## 配置要求

### 必需配置

#### 1. 火山引擎 API (豆包大模型)
- **API Key**: 需要火山引擎账号
- **模型**:
  - `doubao-seed-1-8-251228` - 文本生成
  - `doubao-seedream-4-5-251128` - 图片生成
- **端点**: `https://ark.cn-beijing.volces.com`

#### 2. MCP 服务端
- **URL**: `http://47.109.91.65:18060/mcp`
- **工具**: `publish_content`
- **参数**:
  ```json
  {
    "title": "string",
    "content": "string",
    "tags": ["string"],
    "images": ["string"]
  }
  ```

#### 3. n8n 数据表
- **Table ID**: `hqQlHmeYfivx3ByD` (notes)
- **字段**:
  - `title` (string)
  - `content` (string)
  - `tags` (string, 逗号分隔)
  - `images` (string, 逗号分隔)

### 可选配置

#### 4. Webhook 端点
- **表单入口**: `https://your-n8n-instance/webhook/xhs-start-time`
- **预览入口**: `https://your-n8n-instance/webhook/b0d17f6d-4ee9-4950-8230-b95a936b43cc-time`

## 使用方法

### 方法 1: 通过 Webhook 表单

1. 访问表单 URL
2. 填写输入内容:
   ```
   主题：AI写作工具
   账号：你的效率闺蜜
   字数：500
   背景：介绍AI写作的优势和使用场景
   ```
3. 点击提交
4. 等待 AI 生成内容
5. 在浏览器中预览
6. 确认发布或选择定时发布

### 方法 2: 通过 API 调用

```bash
curl -X POST https://your-n8n-instance/webhook/b0d17f6d-4ee9-4950-8230-b95a936b43cc-time \
  -H "Content-Type: application/json" \
  -d '{
    "chatInput": "主题：AI写作工具，账号：你的效率闺蜜，字数：500，背景：介绍AI写作的优势"
  }'
```

### 方法 3: JSON 格式输入

```json
{
  "topic": "AI写作工具",
  "accounts": ["你的效率闺蜜"],
  "word_count": 500,
  "context": "介绍AI写作的优势和使用场景"
}
```

## 高级功能

### 1. 矩阵账号发布

支持同时为多个小红书账号生成差异化内容:

```
账号：张三,李四,王五
```

每个账号会收到:
- 相同的主题和核心内容
- 差异化的正文表达
- 独立的发布任务

### 2. 定时发布

在预览页面选择:
- **立即发布**: 马上发布到小红书
- **定时发布**: 选择具体时间 (YYYY-MM-DD HH:mm:ss)

### 3. 调试模式

使用 "Manual Debug Trigger" 节点:
- 不消耗 AI Token
- 生成模拟数据
- 用于测试前端交互和发布流程

## 输出格式

### 最终数据结构

```json
{
  "title": "AI写作工具，1秒搞定爆款文案！",
  "content": "还在为写文案发愁吗？😱\n\nAI写作工具来了，只需1秒...",
  "tags": ["#AI写作", "#效率工具", "#小红书技巧"],
  "images": [
    "https://ark.cn-beijing.volces.com/api/v3/images/.../cover.png",
    "https://ark.cn-beijing.volces.com/api/v3/images/.../content1.png",
    "https://ark.cn-beijing.volces.com/api/v3/images/.../content2.png"
  ]
}
```

## 最佳实践

### 1. 标题创作

**二极管标题法**:
- 正面刺激: "产品+只需1秒+便可开挂"
- 负面刺激: "你不X+绝对会后悔+（紧迫感）"

**示例**:
- ✅ "AI写作，只需1秒，便可开挂！"
- ✅ "不学AI写作，绝对会后悔！"
- ❌ "AI写作工具介绍" (太平淡)

### 2. 正文结构

```
开篇钩子 (3秒抓住注意力)
    ↓
核心内容 (价值输出)
    ↓
互动引导 (增加互动)
```

### 3. 图片建议

- **封面**: 抓眼球的视觉冲击
- **内容图**: 对应正文观点的画面表达
- **风格**: 统一的视觉风格
- **避免**: 文字过多、水印、Logo

### 4. 标签策略

- 从小红书热门关键词包选择
- 3-5个标签
- 相关性强
- 避免过度堆砌

## 注意事项

### 安全性
- ✅ Cookie 不暴露在前端
- ✅ API Key 存储在 n8n 凭证中
- ⚠️ 定期更新 Cookie (有效期问题)
- ⚠️ 不要提交 Cookie 到版本控制

### 平台限制
- ✅ 避免频繁发布
- ✅ 控制发布频率
- ⚠️ 小红书可能限制新账号发布
- ⚠️ 注意平台规则变化

### 成本控制
- **LLM 调用**: 每篇笔记约 3-5 次调用
- **图片生成**: 封面1张 + 内容2-3张
- **建议**: 先用调试模式测试流程

## 故障排查

### 常见问题

1. **图片生成失败**
   - 检查火山引擎 API Key
   - 确认账户余额充足
   - 检查 Prompt 是否合规

2. **LLM 输出解析错误**
   - 查看 JSON 解析器日志
   - 调整 LLM 提示词
   - 使用更严格的 JSON 格式要求

3. **预览无法显示**
   - 检查 Webhook URL 配置
   - 确认 n8n 实例可访问
   - 查看浏览器控制台错误

4. **发布失败**
   - 检查 MCP 服务端状态
   - 确认小红书 Cookie 有效
   - 查看发布接口返回错误

## 技术栈

- **工作流引擎**: n8n
- **LLM**: 火山引擎 Doubao (豆包)
- **图片生成**: Doubao-Seedream
- **发布接口**: MCP (Model Context Protocol)
- **数据存储**: n8n Data Table
- **前端**: HTML + CSS + JavaScript

## 扩展功能

### 可集成的额外功能

1. **内容分析**: 分析发布后的数据表现
2. **A/B 测试**: 对比不同标题/内容的转化率
3. **自动优化**: 根据数据反馈自动调整生成策略
4. **多平台支持**: 扩展到抖音、B站等平台
5. **评论管理**: 自动回复和管理评论

## 相关资源

- [Auto-Redbook-Skills 仓库](https://github.com/comeonzhj/Auto-Redbook-Skills)
- [火山引擎 API 文档](https://www.volcengine.com/docs)
- [n8n 官方文档](https://docs.n8n.io)
- [MCP 协议规范](https://modelcontextprotocol.io)

## 版本历史

- **v1.0** - 基础功能：内容生成、图片创建、预览确认、发布
- **v1.1** - 新增：矩阵账号差异化、定时发布
- **v1.2** - 优化：二极管标题法、热门关键词集成

## 许可证

MIT License

---

**💡 提示**: 本 Skill 完整整合了 n8n 工作流和 Auto-Redbook-Skills 的最佳实践，提供一站式的小红书自动化发布解决方案。