---
name: xhs-auto-publish
description: |
  小红书自动化发布工具 - 可执行版本。自动生成小红书笔记内容、图片、预览页面，并准备发布。调用 Python 程序完成完整流程。
---

# 小红书自动化发布 Skill

这是一个可执行的 skill，用于自动化生成和发布小红书笔记内容。

## 功能特性

- ✅ 自动生成笔记内容（标题、正文、标签）
- ✅ 自动生成图片（封面图 + 2-3张内容图）
- ✅ 生成 HTML 预览页面
- ✅ 准备发布数据和文件
- ✅ 支持多种发布方式（MCP、浏览器、模拟）

## 使用方法

### 基本用法

在 CLI（cc等） 中，当需要生成小红书笔记时，直接说明主题和需求：

```
帮我生成一篇关于"实战篇，制作自己的skill"的小红书笔记
```

### 完整参数

```
生成小红书笔记：
- 主题：实战篇，制作自己的skill
- 字数：600字
- 背景：面向程序员和技术工作者
- 快速发布：否（显示预览）
- 发布方式：浏览器
```

## 工作流程

当用户请求生成小红书笔记时，skill 会：

1. **解析用户需求**
   - 提取主题、字数、背景等信息
   - 确定发布方式和选项

2. **调用 Python 程序**
   - 执行 `python run.py` 或 `python run.py -t "主题" -w 字数`
   - 传递解析的参数

3. **生成内容**
   - 调用火山引擎 API 生成标题、正文、标签
   - 使用二极管标题法，符合小红书规范

4. **生成图片**
   - 调用火山引擎图片生成 API
   - 生成封面图和内容图（1728x2304px）
   - 遵循图片规范（无水印、无文字、无logo）

5. **生成预览**
   - 创建 HTML 预览页面
   - 在浏览器中打开预览

6. **准备发布**
   - 生成 JSON 数据文件
   - 生成发布清单
   - 保存所有文件到 output 目录

7. **等待确认**
   - 显示预览效果
   - 询问用户是否确认发布

8. **执行发布**（可选）
   - 根据用户选择执行发布
   - 支持浏览器自动发布
   - 支持MCP服务端发布

## 输出文件

执行完成后，会在 `output` 目录生成以下文件：

- `cover_0_xxx.png` - 封面图
- `content_1_xxx.png` - 内容图1
- `content_2_xxx.png` - 内容图2
- `preview_xxx.html` - HTML预览页面
- `content_xxx.json` - 完整数据（JSON格式）
- `manifest_xxx.txt` - 发布清单

## 命令行参数映射

| 用户输入 | Python参数 | 说明 |
|---------|-----------|------|
| 主题 | `-t, --topic` | 笔记主题 |
| 字数 | `-w, --word-count` | 正文字数（默认600） |
| 背景 | `-c, --context` | 背景说明 |
| 快速发布 | `-q, --quick` | 跳过预览直接发布 |
| 发布方式 | 需在代码中映射 | auto/mcp/browser |

## 内容规范

生成的笔记内容严格遵循以下规范：

### 标题规范
- 使用二极管标题法
- 字数 < 20字
- 包含数字
- 使用 emoji

### 正文规范
- 字数 100-1000字
- 开篇有钩子（痛点引入）
- 包含实际案例或数据
- 结尾有互动引导
- 口语化表达

### 标签规范
- 5-10个标签
- 1个主标签 + 2-4个相关标签 + 1-2个热门标签
- 格式：#标签名

### 图片规范
- 尺寸：1728x2304px（3:4）
- 格式：PNG
- 无水印、无文字、无logo
- 现代简洁风格

## 环境要求

### 必需
- Python 3.7+
- requests >= 2.31.0
- openai >= 1.0.0

### 可选
- playwright >= 1.40.0（用于浏览器发布）

### API 配置
需要在 `.env` 文件中配置火山引擎 API：

```env
XHS_API_KEY=your_api_key_here
XHS_API_ENDPOINT=https://ark.cn-beijing.volces.com/api/v3
XHS_MODEL=doubao-seed-1-8-251228
XHS_IMAGE_MODEL=doubao-seedream-4-5-251128
```

## 质量检查

生成的笔记会自动进行质量检查：

- [ ] 标题 < 20字
- [ ] 标题包含数字
- [ ] 开篇有钩子
- [ ] 正文长度适中
- [ ] 包含实际案例
- [ ] 结尾有互动
- [ ] 标签数量适当
- [ ] 图片数量适当
- [ ] 图片尺寸正确

## 发布方式

### 1. 模拟发布（默认）
仅模拟发布流程，不实际发布到小红书。用于测试和验证。

### 2. MCP 服务端发布
通过 MCP 服务端发布到小红书。需要配置 `XHS_MCP_URL`。

### 3. 浏览器自动发布
使用 Playwright 自动操作浏览器发布到小红书。需要：
- 安装 playwright: `pip install playwright`
- 安装浏览器: `playwright install`

## 注意事项

1. **API Key 安全**：不要在代码中硬编码 API Key，使用 `.env` 文件
2. **图片生成**：图片生成需要时间，请耐心等待
3. **发布限制**：注意小红书的发布频率限制
4. **内容合规**：确保内容符合小红书社区规范

## 故障排查

### API Key 未配置
```
❌ 未配置火山引擎 API Key
💡 配置方式:
   1. 编辑 .env 文件，设置 XHS_API_KEY
   2. 设置环境变量 XHS_API_KEY
```

### 图片下载失败
```
⚠️  图片下载失败
💡 请检查网络连接和火山引擎 API 配置
```

### 浏览器发布失败
```
⚠️  浏览器发布失败
💡 请检查是否安装了 playwright: pip install playwright && playwright install
```

## 示例对话

**用户**：
```
帮我生成一篇关于"AI编程助手使用技巧"的小红书笔记，字数800字
```

**AI响应**：
```
好的，我来为你生成小红书笔记。

🚀 正在启动小红书自动化发布工具...

📋 主题: AI编程助手使用技巧
📋 字数: 800
📋 发布方式: auto

[执行 Python 程序...]
✅ 标题: AI助手+只需3招+效率翻倍
✅ 正文生成完成
✅ 图片生成完成，共 3 张
👀 预览已打开: output/preview_xxx.html

📤 准备发布...
[生成发布数据和文件]
✅ 所有文件已保存到 output 目录

📦 生成文件：
- cover_0_xxx.png (封面图)
- content_1_xxx.png (内容图1)
- content_2_xxx.png (内容图2)
- preview_xxx.html (预览页面)
- content_xxx.json (完整数据)
- manifest_xxx.txt (发布清单)

查看发布清单了解详情！
```

## 与规范 Skill 的区别

| 特性 | xiaohongshu-automation (规范) | xhs-auto-publish (执行) |
|------|-----------------------------|------------------------|
| 类型 | 文档规范 | 可执行程序 |
| 功能 | 指导内容创作 | 自动生成和发布 |
| 调用方式 | 作为知识库参考 | 执行 Python 程序 |
| 输出 | 规范和建议 | 实际的笔记和图片 |
| 使用场景 | 学习小红书创作规范 | 批量生成和发布 |

## 维护

如需更新内容规范，请编辑 `xiaohongshu-automation/SKILL.md`。

如需修改执行逻辑，请编辑 `src/xhs_auto.py`。